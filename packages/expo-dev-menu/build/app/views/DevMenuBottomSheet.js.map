{"version":3,"file":"DevMenuBottomSheet.js","sourceRoot":"","sources":["../../../src/app/views/DevMenuBottomSheet.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport {\n  EventSubscription,\n  StyleSheet,\n  TouchableWithoutFeedback,\n  View,\n  Dimensions,\n} from 'react-native';\nimport Animated from 'react-native-reanimated';\n\nimport DevMenuContext from '../DevMenuContext';\nimport { closeMenuAsync } from '../DevMenuInternal';\nimport Colors from '../constants/Colors';\nimport * as DevMenu from './DevMenuModule';\nimport ScrollBottomSheet from './ScrollBottomSheet';\n\ntype Props = {\n  uuid: string;\n};\n\nclass DevMenuBottomSheet extends React.PureComponent<Props, any> {\n  static contextType = DevMenuContext;\n\n  ref = React.createRef<ScrollBottomSheet<any>>();\n\n  // snapPoints = [0, Math.max(BottomSheet.renumber('50%'), 600), '90%'];\n  snapPoints = ['10%', '35%', '100%'];\n\n  callbackNode = new Animated.Value(0);\n\n  backgroundOpacity = this.callbackNode.interpolate({\n    inputRange: [0, 1],\n    // outputRange: [0.5, 0],\n    outputRange: [0, 0.5],\n  });\n\n  closeSubscription: EventSubscription | null = null;\n\n  componentDidMount() {\n    this.expand();\n\n    // Before the dev menu can be actually closed, we need to collapse its sheet view,\n    // and this listens for close requests that come from native side to start collapsing the view.\n    // The awaited return value of this listener is then send back as a response\n    // so the native module knows when it can fully close dev menu (detach its root view).\n    this.closeSubscription = DevMenu.listenForCloseRequests(() => {\n      // Unsubscribe immediately so we don't accidentally collapse twice.\n      // Also componentWillUnmount is not called (why?) when the app is hot reloading this component,\n      // despite the componentDidMount is later called after first render.\n      this.unsubscribeCloseSubscription();\n\n      // `collapse` returns a promise, so this `return` is important to finish the close event once the view is fully collapsed.\n      return this.collapse();\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    // Make sure it gets expanded once we receive new identifier.\n    if (prevProps.uuid !== this.props.uuid) {\n      this.expand();\n    }\n  }\n\n  componentWillUnmount() {\n    this.unsubscribeCloseSubscription();\n  }\n\n  collapse = (): Promise<void> => {\n    this.ref.current && this.ref.current.snapTo(this.snapPoints.length - 1);\n\n    // Use setTimeout until there is a better solution to execute something once the sheet is fully collapsed.\n    return new Promise(resolve => setTimeout(resolve, 300));\n  };\n\n  collapseAndClose = async () => {\n    await this.collapse();\n    await closeMenuAsync();\n  };\n\n  expand = () => {\n    this.ref.current && this.ref.current.snapTo(1);\n  };\n\n  unsubscribeCloseSubscription = () => {\n    if (this.closeSubscription) {\n      this.closeSubscription.remove();\n      this.closeSubscription = null;\n    }\n  };\n\n  onCloseEnd = () => {\n    this.collapseAndClose();\n  };\n\n  providedContext = {\n    expand: this.expand,\n    collapse: this.collapse,\n  };\n\n  renderContent = () => {\n    return <View style={styles.bottomSheetContent}>{this.props.children}</View>;\n  };\n\n  innerRef = React.createRef();\n\n  render() {\n    const providedContext = {\n      ...this.props,\n      ...this.providedContext,\n    };\n\n    return (\n      <DevMenuContext.Provider value={providedContext}>\n        <View style={styles.bottomSheetContainer}>\n          <TouchableWithoutFeedback onPress={this.collapseAndClose}>\n            <Animated.View\n              style={[styles.bottomSheetBackground, { opacity: this.backgroundOpacity }]}\n            />\n          </TouchableWithoutFeedback>\n          <ScrollBottomSheet\n            ref={this.ref}\n            componentType=\"ScrollView\"\n            snapPoints={this.snapPoints}\n            initialSnapIndex={this.snapPoints.length - 1}\n            animatedPosition={this.callbackNode}\n            renderHandle={() => null}\n            // contentContainerStyle={{ flex: 1 }}\n            style={styles.bottomSheet}>\n            {this.renderContent()}\n          </ScrollBottomSheet>\n        </View>\n      </DevMenuContext.Provider>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  bottomSheetContainer: {\n    flex: 1,\n    backgroundColor: 'red',\n  },\n  bottomSheetBackground: {\n    flex: 1,\n    backgroundColor: '#000',\n  },\n  bottomSheet: {\n    height: Dimensions.get('window').height,\n    // paddingTop: 10,\n    borderTopLeftRadius: 10,\n    borderTopRightRadius: 10,\n    backgroundColor: Colors.dark.menuBackground,\n    overflow: 'hidden',\n  },\n  bottomSheetContent: {\n    flex: 1,\n    backgroundColor: 'green',\n  },\n});\n\nexport default DevMenuBottomSheet;\n"]}